---
- name: Sprint facts
  c2platform.core.set_sprint_facts: {}

- name: Search Jira
  community.general.jira:
    uri: "{{ logs_jira_server_uri }}"
    username: "{{ logs_jira_username}}"
    password: "{{ logs_jira_password }}"
    operation: search
    maxresults: "{{ logs_jira_maxresults|default(omit) }}"
    jql: "updated >= {{ sprint['start'] }} AND updated <= {{ sprint['end'] }}  order by updated asc"
  args:
    fields:
      comment: null
      summary: null
  register: _issues

- name: Sprint facts
  c2platform.core.set_sprint_facts: {}

- name: Log
  c2platform.test.log:
    issues: "{{ _issues['meta']['issues'] }}"
    sprint: "{{ sprint }}"
  register: _logs

- copy: # debug
    content: "{{ {'sprint': sprint, '_logs': _logs, 'issues': _issues['meta']['issues'] }|to_nice_yaml }}"
    dest: /tmp/log.yml
